---
import { getCollection } from 'astro:content';
import { SITE_TITLE, SITE_DESCRIPTION } from '../consts';

const posts = await getCollection('blog');
const tagCounts = new Map<string, number>();
posts.forEach((post) => {
	post.data.tags?.forEach((tag) => {
		tagCounts.set(tag, (tagCounts.get(tag) || 0) + 1);
	});
});
const topTags = [...tagCounts.entries()]
	.sort((a, b) => b[1] - a[1])
	.slice(0, 5)
	.map(([tag]) => tag);
---

<header>
	<nav>
		<div class="site-info">
			<a href="/" class="site-title">{SITE_TITLE}</a>
			<span class="tagline">{SITE_DESCRIPTION}</span>
		</div>
		<div class="nav-links">
			<a href="/about">About</a>
			<a href="/rss.xml">RSS</a>
		</div>
	</nav>
	<div class="topics">
		<span class="topics-label">Read more about:</span>
		{topTags.map((tag) => (
			<a href={`/tags/${tag}/`} class="topic">#{tag}</a>
		))}
	</div>
</header>

<style>
	header {
		background: var(--header-bg);
		border-bottom: 1px solid var(--header-border);
		margin-bottom: 2rem;
	}
	nav {
		max-width: 650px;
		margin: 0 auto;
		padding: 1rem;
		display: flex;
		justify-content: space-between;
		align-items: center;
	}
	.site-info {
		display: flex;
		align-items: baseline;
		gap: 0.6rem;
		flex-wrap: wrap;
	}
	.site-title {
		font-weight: 600;
		text-decoration: none;
		color: var(--header-title);
	}
	.tagline {
		color: var(--header-tagline);
		font-size: 0.8rem;
		font-style: italic;
	}
	.nav-links a {
		margin-left: 1.5rem;
		font-size: 0.85rem;
	}
	.topics {
		max-width: 650px;
		margin: 0 auto;
		padding: 0 1rem 1rem;
		font-size: 0.8rem;
		display: flex;
		gap: 0.75rem;
		flex-wrap: wrap;
		align-items: center;
	}
	.topics-label {
		color: var(--text-light);
	}
	.topic {
		color: var(--link);
		text-decoration: none;
	}
	.topic:hover {
		text-decoration: underline;
	}

	@media (max-width: 480px) {
		header {
			margin-bottom: 1.5rem;
		}
		nav {
			padding: 0.75rem 1rem;
		}
		.site-info {
			flex-direction: column;
			align-items: flex-start;
			gap: 0.2rem;
		}
		.tagline {
			font-size: 0.75rem;
		}
	}
</style>
